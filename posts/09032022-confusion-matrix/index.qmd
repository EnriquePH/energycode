---
title: "Confusion Matrix in R"
description: "Plotting a Confusion Matrix with ggplot in R"
date: "2022-03-09"
image: conf_matrix.png
lang: en
categories:
  - R
  - Machine Learning
bibliography: conf_matrix.bib
nocite: |
  @*
draft: false
editor: source
---

# Confusion Matrix

The confusion matrix is a useful tool for visualizing the performance of a
classification algorithm. In this blog post, we provide a function to generate
an image of the confusion matrix. Additionally, the R package `caret` includes
the `confusionMatrix` function, which produces detailed output.

```{r}
#| label: load_packages
#| echo: true
#| message: false
library(e1071)
library(caTools)
library(ggplot2)
library(scales)
library(caret)
```

## Classification

We will conduct a [Naive Bayes
classification](https://en.wikipedia.org/wiki/Naive_Bayes_classifier) using the
classic Iris dataset.

```{r}
#| label: classification

# train and test data
iris$spl <- caTools::sample.split(iris, SplitRatio = 0.8)
train <- subset(iris, iris$spl == TRUE)
test <- subset(iris, iris$spl == FALSE)

iris_nb <- naiveBayes(Species ~ ., data = train)
nb_train_predict <- predict(iris_nb, test[, names(test) != "Species"])

cfm <- confusionMatrix(nb_train_predict, test$Species)
cfm
```

## Plotting

To plot the resulting confusion matrix using `ggplot`, we use the following
function:

```{r}
#| label: plot_confusion
#| fig-alt: function for plotting confusion matrix
ggplot_confusion_matrix <- function(cfm) {
  mytitle <- paste("Accuracy", percent_format() (cfm$overall[1]),
                   "Kappa", percent_format() (cfm$overall[2]))
  p <-
    ggplot(data = as.data.frame(cfm$table),
           aes(x = Reference, y = Prediction)) +
    geom_tile(aes(fill = log(Freq)), colour = "white") +
    scale_fill_gradient(low = "white", high = "steelblue") +
    geom_text(aes(x = Reference, y = Prediction, label = Freq)) +
    theme(legend.position = "none") +
    ggtitle(mytitle)
  return(p)
}
```

```{r}
ggplot_confusion_matrix(cfm)
```

## References
